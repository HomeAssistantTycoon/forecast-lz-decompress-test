name: Decompress BRRES LZ Files

on:
  workflow_dispatch:
    inputs:
      output_name:
        description: "Name for the output folder"
        required: false
        default: "output"

jobs:
  decompress:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Wiimms SZS Tools
        run: |
          mkdir -p tools
          tar -xzf tools/szs-v2.42a-r8989-x86_64.tar.gz -C tools
          chmod +x tools/szs-v2.42a-r8989-x86_64/bin/*
          sudo cp tools/szs-v2.42a-r8989-x86_64/bin/* /usr/local/bin/
          echo "Installed Wiimms tools successfully"
          wszst --version

      - name: Create output folder
        run: mkdir -p "${{ github.event.inputs.output_name }}/brres"

      - name: Decompress .brres.lz files
        run: |
          echo "Listing input folder contents:"
          ls -l input/
          echo "Starting decompression..."
          for file in input/*.brres.lz; do
            if [ ! -f "$file" ]; then
              echo "No .brres.lz files found, skipping."
              continue
            fi
            echo "Decompressing $file â†’ ${{ github.event.inputs.output_name }}/brres/"
            wszst decompress "$file" -o "${{ github.event.inputs.output_name }}/brres/" || echo "Failed: $file"
          done
          echo "Final decompressed files:"
          ls -l "${{ github.event.inputs.output_name }}/brres/"
          echo "Decompression completed."

      - name: Upload decompressed files
        uses: actions/upload-artifact@v4
        with:
          name: decompressed-brres
          path: ${{ github.event.inputs.output_name }}/brres/
